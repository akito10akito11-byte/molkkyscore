<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ«ãƒƒã‚¯ã‚¹ã‚³ã‚¢</title>
    
<style>
/* =========================================
   åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«
   ========================================= */
body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
}

h1 {
    text-align: center;
    margin-bottom: 10px;
}

button {
    padding: 10px 20px;
    margin-top: 10px;
    font-size: 16px;
    cursor: pointer;
}

input {
    flex: 1;
    padding: 8px;
    font-size: 16px;
}

/* =========================================
   ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢
   ========================================= */
#setup-screen {
    max-width: 350px;
    width: 90%;
    background: white;
    padding: 20px;
    margin: 20px auto;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

.player-input {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

/* =========================================
   ã‚²ãƒ¼ãƒ ç”»é¢è¦ç´ 
   ========================================= */
/* ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ */
.scoreboard {
    display: none;
    margin: 20px auto;
    width: 90%;
    max-width: 350px;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

.player-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 16px;
}

/* ãƒ”ãƒ³å…¥åŠ›ã‚¨ãƒªã‚¢ */
.pins-container {
    display: none;
    flex-wrap: wrap;
    width: 100%;
    max-width: 330px;
    margin: 20px auto;
    justify-content: center;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 10px;
}

.pin {
    width: 50px;
    height: 70px;
    background: #ffe6b3;
    border: 3px solid #cc9933;
    border-radius: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
    flex-shrink: 0;
}

.pin:active {
    transform: scale(0.9);
    background: #ffcc66;
}

.undo-pin {
    background: #e0e0e0;
    border: 3px dashed #999;
    font-size: 16px;
}

.undo-pin:active {
    background: #ccc;
}

.pin.double-width {
    flex: 0 0 calc(50px * 2 + 10px);
    display: flex;
    justify-content: center;
    align-items: center;
}

/* ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆ */
#scoresheet-container {
    display: none;
    width: 95%;
    max-width: 700px;
    margin: 20px auto;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    overflow-x: auto;
}

#scoresheet {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
}

#scoresheet th,
#scoresheet td {
    border: 1px solid #ccc;
    padding: 6px;
    height: 30px;
    min-width: 40px;
}

#scoresheet tr:nth-child(even) {
    background: #f9f9f9;
}

/* é€šçŸ¥ãƒ»ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
#message-box {
    display: none;
    width: 90%;
    max-width: 400px;
    margin: 10px auto;
    padding: 10px;
    background: #ffe6cc;
    border: 2px solid #cc6600;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
}

#reset-btn {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 25px;
    font-size: 16px;
    cursor: pointer;
    z-index: 1000;
    background: #ffeb99;
    border: 2px solid #cc6600;
    border-radius: 8px;
}

#top-message-box {
    display: none;
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffeb99;
    border: 2px solid #cc6600;
    border-radius: 8px;
    padding: 12px 20px;
    font-size: 18px;
    font-weight: bold;
    z-index: 1000;
}

/* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å‘ã‘ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media screen and (max-width: 480px) {
    .pin {
        width: 45px;
        height: 60px;
        font-size: 18px;
    }
    .player-row {
        font-size: 16px;
    }
    button {
        font-size: 14px;
        padding: 8px 16px;
    }
    input {
        font-size: 14px;
        padding: 6px;
    }
    #scoresheet th,
    #scoresheet td {
        min-width: 35px;
        padding: 6px;
        font-size: 16px;
    }
}
</style>
</head>
<body>

    <h1>ãƒ¢ãƒ«ãƒƒã‚¯ã‚¹ã‚³ã‚¢</h1>

    <div id="setup-screen">
        <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›</h2>
        <div id="player-inputs">
            <div class="player-input">
                <input type="text" placeholder="Player 1" class="player-name">
            </div>
            <div class="player-input">
                <input type="text" placeholder="Player 2" class="player-name">
            </div>
        </div>
        <button onclick="addPlayer()">ï¼‹ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ </button><br>
        <button onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    </div>

    <div id="top-message-box"></div>
    
    <div class="scoreboard" id="scoreboard"></div>
    
    <div class="pins-container" id="pins"></div>
    
    <div id="scoresheet-container">
        <h3>ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆ</h3>
        <table id="scoresheet"></table>
    </div>
    
    <div id="message-box"></div>
    <button id="reset-btn">ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ</button>

<script>
    // =========================================
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨DOMè¦ç´ ã®å–å¾—
// =========================================
let players = [];        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±
let turn = 0;           // ç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
let currentTurn = 1;    // ç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³æ•°ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰æ•°ï¼‰
let gameOver = false;   // ã‚²ãƒ¼ãƒ çµ‚äº†ãƒ•ãƒ©ã‚°
let historyStack = [];  // å±¥æ­´ä¿å­˜ç”¨ã‚¹ã‚¿ãƒƒã‚¯

const setupScreen = document.getElementById("setup-screen");
const scoreboard = document.getElementById("scoreboard");
const pins = document.getElementById("pins");
const scoresheetContainer = document.getElementById("scoresheet-container");
const scoresheet = document.getElementById("scoresheet");
const resetBtn = document.getElementById("reset-btn");
const topMessageBox = document.getElementById("top-message-box");

// åˆæœŸåŒ–
resetBtn.style.display = "none";


// =========================================
// ã‚²ãƒ¼ãƒ è¨­å®šãƒ»é–‹å§‹å‡¦ç†
// =========================================

/**
 * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥åŠ›æ¬„ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
 */
function addPlayer() {
    const div = document.createElement("div");
    div.className = "player-input";
    const index = document.querySelectorAll(".player-name").length + 1;
    div.innerHTML = `<input type="text" placeholder="Player ${index}" class="player-name">`;
    document.getElementById("player-inputs").appendChild(div);
}

/**
 * ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
 * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’åˆæœŸåŒ–ã—ã€ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
 */
function startGame() {
    const names = [...document.querySelectorAll(".player-name")].map(i => i.value.trim() || i.placeholder);
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
    players = names.map(n => ({
        name: n,
        score: 0,
        miss: 0,
        eliminated: false
    }));

    // ç”»é¢è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
    setupScreen.style.display = "none";
    scoreboard.style.display = "block";
    pins.style.display = "flex";
    scoresheetContainer.style.display = "block";

    // ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆã¨ãƒœãƒ¼ãƒ‰ã®æç”»
    createScoreSheet();
    renderScoreboard();
}


// =========================================
// çŠ¶æ…‹ç®¡ç†ï¼ˆUndoæ©Ÿèƒ½ï¼‰
// =========================================

/**
 * ç¾åœ¨ã®çŠ¶æ…‹ã‚’ã‚¹ã‚¿ãƒƒã‚¯ã«ä¿å­˜ã™ã‚‹é–¢æ•°
 */
function saveState() {
    historyStack.push({
        // JSONå¤‰æ›ã§ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
        players: JSON.parse(JSON.stringify(players)),
        turn: turn,
        currentTurn: currentTurn,
        gameOver: gameOver,
        scoresheet: scoresheet.innerHTML
    });
}

/**
 * ç›´å‰ã®çŠ¶æ…‹ã«æˆ»ã™é–¢æ•°ï¼ˆUndoï¼‰
 */
function undo() {
    if (historyStack.length === 0) return;

    const s = historyStack.pop();
    players = s.players;
    turn = s.turn;
    currentTurn = s.currentTurn;
    gameOver = s.gameOver;
    scoresheet.innerHTML = s.scoresheet;

    // è¡¨ç¤ºã®ãƒªã‚»ãƒƒãƒˆ
    topMessageBox.style.display = "none";
    resetBtn.style.display = gameOver ? "block" : "none";
    renderScoreboard();
}


// =========================================
// è¡¨ç¤ºãƒ»æç”»é–¢é€£
// =========================================

/**
 * ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆã®åˆæœŸãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹é–¢æ•°
 */
function createScoreSheet() {
    scoresheet.innerHTML = "";
    
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã®ä½œæˆ
    let header = "<tr><th>ã‚¿ãƒ¼ãƒ³</th>";
    players.forEach(p => header += `<th>${p.name}</th><th>åˆè¨ˆ</th>`);
    header += "</tr>";
    scoresheet.innerHTML += header;

    // 15ã‚¿ãƒ¼ãƒ³åˆ†ï¼ˆä»®ï¼‰ã®ç©ºè¡Œã‚’ä½œæˆ
    for (let i = 1; i <= 15; i++) {
        let row = `<tr id="turn-${i}"><td>${i}</td>`;
        players.forEach(() => row += "<td></td><td></td>");
        row += "</tr>";
        scoresheet.innerHTML += row;
    }
}

/**
 * ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆã«çµæœã‚’è¨˜éŒ²ã™ã‚‹é–¢æ•°
 * è¨˜å·å…¥åŠ›ãƒœã‚¿ãƒ³ã‚‚åŒæ™‚ã«ç”Ÿæˆã™ã‚‹
 */
function recordToScoreSheet(playerIndex, score) {
    let row = document.getElementById(`turn-${currentTurn}`);
    
    // è¡ŒãŒè¶³ã‚Šãªã„å ´åˆã®å®‰å…¨ç­–ï¼ˆå¿…è¦ã§ã‚ã‚Œã°è¡Œè¿½åŠ å‡¦ç†ã‚’å…¥ã‚Œã‚‹ï¼‰
    if (!row) return; 

    const cells = row.querySelectorAll("td");
    const scoreCell = 1 + playerIndex * 2;
    const totalCell = scoreCell + 1;
    
    const originalScore = score === 0 ? "-" : score;
    
    cells[scoreCell].textContent = originalScore;
    cells[totalCell].textContent = players[playerIndex].score;

    // è¨˜å·å…¥åŠ›ç”¨ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ
    const btnContainer = document.createElement("div");
    btnContainer.style.display = "flex";
    btnContainer.style.justifyContent = "center";
    btnContainer.style.gap = "4px";

    // ãƒœã‚¿ãƒ³ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
    const createBtn = (text, onClickText) => {
        const btn = document.createElement("button");
        btn.textContent = text;
        btn.style.fontSize = "14px";
        btn.style.padding = "2px 5px";
        btn.onclick = () => { cells[scoreCell].textContent = onClickText; };
        return btn;
    };

    btnContainer.appendChild(createBtn(originalScore, originalScore));
    btnContainer.appendChild(createBtn(originalScore + ".", originalScore + "."));
    btnContainer.appendChild(createBtn(originalScore + "â–¡", originalScore + "â–¡"));

    // â‘ ã€œâ‘«ã®ä¸¸æ•°å­—ãƒœã‚¿ãƒ³ï¼ˆå¾—ç‚¹ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
    if (score >= 1 && score <= 12) {
        const circled = String.fromCharCode(0x2460 + score - 1);
        const btnCircled = document.createElement("button");
        btnCircled.textContent = circled;
        btnCircled.style.fontSize = "14px";
        btnCircled.style.padding = "2px 5px";
        btnCircled.onclick = () => { cells[scoreCell].textContent = circled; };
        btnContainer.appendChild(btnCircled);
    }

    cells[scoreCell].appendChild(btnContainer);
}

/**
 * ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ï¼ˆç”»é¢ä¸Šéƒ¨ï¼‰ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
 */
function renderScoreboard() {
    scoreboard.innerHTML = "";
    players.forEach((p, i) => {
        scoreboard.innerHTML += `
            <div class="player-row">
                <span>${i === turn ? "ğŸ‘‰ " : ""}${p.name}${p.eliminated ? "ï¼ˆè„±è½ï¼‰" : ""}</span>
                <span>${p.score} ç‚¹</span>
            </div>`;
    });
}


// =========================================
// ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
// =========================================

/**
 * ãƒ”ãƒ³ãŒå€’ã•ã‚ŒãŸã¨ãã®å‡¦ç†ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
 * @param {number} num - å€’ã—ãŸãƒ”ãƒ³ã®ç‚¹æ•°ï¼ˆ0ã€œ12ï¼‰
 */
function hitPin(num) {
    if (gameOver) return;
    
    saveState(); // å±¥æ­´ä¿å­˜
    
    const p = players[turn];

    if (num === 0) {
        // ãƒŸã‚¹ã®å ´åˆ
        p.miss++;
        if (p.miss >= 3) {
            p.eliminated = true; // 3å›é€£ç¶šãƒŸã‚¹ã§è„±è½
        }
        recordToScoreSheet(turn, 0);
    } else {
        // å¾—ç‚¹ã®å ´åˆ
        p.miss = 0;
        p.score += num;
        
        // 50ç‚¹ã‚ªãƒ¼ãƒãƒ¼ãƒ«ãƒ¼ãƒ«
        if (p.score > 50) {
            p.score = 25;
        }
        recordToScoreSheet(turn, num);
    }

    renderScoreboard();

    // å‹åˆ©åˆ¤å®š
    if (p.score === 50) {
        topMessageBox.style.display = "none";
        gameOver = true;
        resetBtn.style.display = "block";
        return;
    }

    nextTurn();
}

/**
 * æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸é€²ã‚€å‡¦ç†
 * è„±è½ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
 */
function nextTurn() {
    let prev = turn;
    
    // æ¬¡ã®æœ‰åŠ¹ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—
    do {
        turn = (turn + 1) % players.length;
    } while (players[turn].eliminated);

    // ä¸€å‘¨ã—ãŸã‚‰ã‚¿ãƒ¼ãƒ³ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰æ•°ã‚’å¢—ã‚„ã™
    if (turn === 0 && prev !== 0) {
        currentTurn++;
    }
}


// =========================================
// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
// =========================================

// ãƒ”ãƒ³ãƒœã‚¿ãƒ³ã®ç”Ÿæˆ
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].forEach(n => {
    const d = document.createElement("div");
    d.className = "pin";
    d.textContent = n;
    d.onclick = () => hitPin(n);
    pins.appendChild(d);
});

// 0ç‚¹ï¼ˆãƒŸã‚¹ï¼‰ãƒ”ãƒ³
const zeroPin = document.createElement("div");
zeroPin.className = "pin";
zeroPin.textContent = "0";
zeroPin.onclick = () => hitPin(0);
pins.appendChild(zeroPin);

// ã‚‚ã©ã‚‹ãƒœã‚¿ãƒ³
const undoPin = document.createElement("div");
undoPin.className = "pin undo-pin double-width";
undoPin.textContent = "ã‚‚ã©ã‚‹";
undoPin.onclick = undo;
pins.appendChild(undoPin);

// ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
resetBtn.onclick = () => location.reload();

</script>
</body>
</html>
