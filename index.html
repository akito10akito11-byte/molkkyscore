<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>„É¢„É´„ÉÉ„ÇØ„Çπ„Ç≥„Ç¢</title>
<style>
/* Âü∫Êú¨„Çπ„Çø„Ç§„É´ */
body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
}
h1 { text-align: center; margin-bottom: 10px; }
#setup-screen { max-width: 350px; width: 90%; background: white; padding: 20px; margin: 20px auto; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
.player-input { display: flex; gap: 10px; margin-bottom: 10px; }
input { flex: 1; padding: 8px; font-size: 16px; }
button { padding: 10px 20px; margin-top: 10px; font-size: 16px; cursor: pointer; }
.scoreboard { display: none; margin: 20px auto; width: 90%; max-width: 350px; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
.player-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 16px; }
.pins-container { display: none; flex-wrap: wrap; width: 100%; max-width: 330px; margin: 20px auto; justify-content: center; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
.pin { width: 50px; height: 70px; background: #ffe6b3; border: 3px solid #cc9933; border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 20px; font-weight: bold; cursor: pointer; transition: 0.2s; flex-shrink: 0; }
.pin:active { transform: scale(0.9); background: #ffcc66; }
.undo-pin { background: #e0e0e0; border: 3px dashed #999; font-size: 16px; }
.undo-pin:active { background: #ccc; }
.pin.double-width { flex: 0 0 calc(50px * 2 + 10px); display: flex; justify-content: center; align-items: center; }
#scoresheet-container { display: none; width: 95%; max-width: 700px; margin: 20px auto; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); overflow-x: auto; }
#scoresheet { width: 100%; border-collapse: collapse; text-align: center; }
#scoresheet th, #scoresheet td { border: 1px solid #ccc; padding: 6px; height: 30px; min-width: 40px; }
#scoresheet tr:nth-child(even) { background: #f9f9f9; }
#message-box { display: none; width: 90%; max-width: 400px; margin: 10px auto; padding: 10px; background: #ffe6cc; border: 2px solid #cc6600; border-radius: 8px; font-size: 16px; font-weight: bold; text-align: center; }
#reset-btn { display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; font-size: 16px; cursor: pointer; z-index: 1000; background: #ffeb99; border: 2px solid #cc6600; border-radius: 8px; }
#top-message-box { display: none; position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: #ffeb99; border: 2px solid #cc6600; border-radius: 8px; padding: 12px 20px; font-size: 18px; font-weight: bold; z-index: 1000; }
@media screen and (max-width: 480px){
    .pin { width: 45px; height: 60px; font-size: 18px; }
    .player-row { font-size: 16px; } 
    button { font-size: 14px; padding: 8px 16px; }
    input { font-size: 14px; padding: 6px; }
    #scoresheet th, #scoresheet td { min-width: 35px; padding: 6px; font-size: 16px; } 
}
</style>
</head>
<body>

<h1>„É¢„É´„ÉÉ„ÇØ„Çπ„Ç≥„Ç¢</h1>

<div id="setup-screen">
    <h2>„Éó„É¨„Ç§„É§„ÉºÂêç„ÇíÂÖ•Âäõ</h2>
    <div id="player-inputs">
        <div class="player-input"><input type="text" placeholder="Player 1" class="player-name"></div>
        <div class="player-input"><input type="text" placeholder="Player 2" class="player-name"></div>
    </div>
    <button onclick="addPlayer()">Ôºã „Éó„É¨„Ç§„É§„ÉºËøΩÂä†</button><br>
    <button onclick="startGame()">„Ç≤„Éº„É†ÈñãÂßã</button>
</div>

<div id="top-message-box"></div>
<div class="scoreboard" id="scoreboard"></div>
<div class="pins-container" id="pins"></div>
<div id="scoresheet-container">
    <h3>„Çπ„Ç≥„Ç¢„Ç∑„Éº„Éà</h3>
    <table id="scoresheet"></table>
</div>
<div id="message-box"></div>
<button id="reset-btn">„Ç≤„Éº„É†„Çí„É™„Çª„ÉÉ„Éà</button>

<script>
let players = [], turn = 0, currentTurn = 1, gameOver = false, historyStack = [];
const setupScreen = document.getElementById("setup-screen");
const scoreboard = document.getElementById("scoreboard");
const pins = document.getElementById("pins");
const scoresheetContainer = document.getElementById("scoresheet-container");
const scoresheet = document.getElementById("scoresheet");
const resetBtn = document.getElementById("reset-btn");
const topMessageBox = document.getElementById("top-message-box");
resetBtn.style.display = "none";

function addPlayer() {
    const div = document.createElement("div");
    div.className = "player-input";
    const index = document.querySelectorAll(".player-name").length + 1;
    div.innerHTML = `<input type="text" placeholder="Player ${index}" class="player-name">`;
    document.getElementById("player-inputs").appendChild(div);
}

function startGame() {
    const names = [...document.querySelectorAll(".player-name")].map(i => i.value.trim() || i.placeholder);
    players = names.map(n => ({ name: n, score: 0, miss: 0, eliminated: false }));
    setupScreen.style.display = "none";
    scoreboard.style.display = "block";
    pins.style.display = "flex";
    scoresheetContainer.style.display = "block";
    createScoreSheet();
    renderScoreboard();
}

function saveState() {
    historyStack.push({
        players: JSON.parse(JSON.stringify(players)),
        turn, currentTurn, gameOver,
        scoresheet: scoresheet.innerHTML
    });
}

function undo() {
    if(historyStack.length===0) return;
    const s = historyStack.pop();
    players=s.players; turn=s.turn; currentTurn=s.currentTurn; gameOver=s.gameOver;
    scoresheet.innerHTML = s.scoresheet;
    topMessageBox.style.display = "none";
    resetBtn.style.display = gameOver ? "block" : "none";
    renderScoreboard();
}

function createScoreSheet() {
    scoresheet.innerHTML="";
    let header="<tr><th>„Çø„Éº„É≥</th>";
    players.forEach(p=>header+=`<th>${p.name}</th><th>ÂêàË®à</th>`);
    header+="</tr>"; scoresheet.innerHTML+=header;
    for(let i=1;i<=15;i++){
        let row=`<tr id="turn-${i}"><td>${i}</td>`;
        players.forEach(()=>row+="<td></td><td></td>");
        row+="</tr>"; scoresheet.innerHTML+=row;
    }
}

function recordToScoreSheet(playerIndex, score){
    let row=document.getElementById(`turn-${currentTurn}`);
    const cells=row.querySelectorAll("td");
    const scoreCell=1+playerIndex*2, totalCell=scoreCell+1;
    const originalScore = score===0?"-":score;
    cells[scoreCell].textContent=originalScore;
    cells[totalCell].textContent=players[playerIndex].score;

    const btnContainer=document.createElement("div");
    btnContainer.style.display="flex";
    btnContainer.style.justifyContent="center";
    btnContainer.style.gap="4px";

    const btnNormal=document.createElement("button");
    btnNormal.textContent=originalScore;
    btnNormal.style.fontSize="14px"; btnNormal.style.padding="2px 5px";
    btnNormal.onclick=()=>{ cells[scoreCell].textContent=originalScore; };
    btnContainer.appendChild(btnNormal);

    const btnDot=document.createElement("button");
    btnDot.textContent=originalScore+".";
    btnDot.style.fontSize="14px"; btnDot.style.padding="2px 5px";
    btnDot.onclick=()=>{ cells[scoreCell].textContent=originalScore+"."; };
    btnContainer.appendChild(btnDot);

    const btnSquare=document.createElement("button");
    btnSquare.textContent=originalScore+"‚ñ°";
    btnSquare.style.fontSize="14px"; btnSquare.style.padding="2px 5px";
    btnSquare.onclick=()=>{ cells[scoreCell].textContent=originalScore+"‚ñ°"; };
    btnContainer.appendChild(btnSquare);

    if(score>=1 && score<=12){
        const circled=String.fromCharCode(0x2460+score-1);
        const btnCircled=document.createElement("button");
        btnCircled.textContent=circled;
        btnCircled.style.fontSize="14px"; btnCircled.style.padding="2px 5px";
        btnCircled.onclick=()=>{ cells[scoreCell].textContent=circled; };
        btnContainer.appendChild(btnCircled);
    }

    cells[scoreCell].appendChild(btnContainer);
}

function renderScoreboard(){
    scoreboard.innerHTML="";
    players.forEach((p,i)=>{
        scoreboard.innerHTML+=`<div class="player-row">
            <span>${i===turn?"üëâ ":""}${p.name}${p.eliminated?"ÔºàËÑ±ËêΩÔºâ":""}</span>
            <span>${p.score} ÁÇπ</span>
        </div>`;
    });
}

function hitPin(num){
    if(gameOver) return;
    saveState();
    const p=players[turn];
    if(num===0){ p.miss++; if(p.miss>=3) p.eliminated=true; recordToScoreSheet(turn,0); }
    else{ p.miss=0; p.score+=num; if(p.score>50)p.score=25; recordToScoreSheet(turn,num);}
    renderScoreboard();
    if(p.score===50){ topMessageBox.style.display="none"; gameOver=true; resetBtn.style.display="block"; return; }
    nextTurn();
}

function nextTurn(){
    let prev=turn;
    do{ turn=(turn+1)%players.length; }while(players[turn].eliminated);
    if(turn===0 && prev!==0) currentTurn++;
}

// „Éî„É≥ÁîüÊàê
[1,2,3,4,5,6,7,8,9,10,11,12].forEach(n=>{
    const d=document.createElement("div");
    d.className="pin"; d.textContent=n; d.onclick=()=>hitPin(n);
    pins.appendChild(d);
});
const zeroPin=document.createElement("div");
zeroPin.className="pin"; zeroPin.textContent="0"; zeroPin.onclick=()=>hitPin(0);
pins.appendChild(zeroPin);

const undoPin=document.createElement("div");
undoPin.className="pin undo-pin double-width"; undoPin.textContent="„ÇÇ„Å©„Çã"; undoPin.onclick=undo;
pins.appendChild(undoPin);

resetBtn.onclick=()=>location.reload();
</script>
</body>
</html>
