<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>„É¢„É´„ÉÉ„ÇØ„Çπ„Ç≥„Ç¢</title>
<style>
/* Âü∫Êú¨„Çπ„Çø„Ç§„É´ */
body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
}

h1 {
    text-align: center;
    margin-bottom: 10px;
}

/* „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÁîªÈù¢ */
#setup-screen {
    max-width: 350px;
    width: 90%;
    background: white;
    padding: 20px;
    margin: 20px auto;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.player-input {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

input {
    flex: 1;
    padding: 8px;
    font-size: 16px;
}

button {
    padding: 10px 20px;
    margin-top: 10px;
    font-size: 16px;
    cursor: pointer;
}

/* „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ */
.scoreboard {
    display: none;
    margin: 20px auto;
    width: 90%;
    max-width: 350px;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.player-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 16px;
}

/* „Éî„É≥ */
.pins-container {
    display: none;
    flex-wrap: wrap;
    width: 100%;
    max-width: 330px;
    margin: 20px auto;
    justify-content: center;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 10px;
}

.pin {
    width: 50px;
    height: 70px;
    background: #ffe6b3;
    border: 3px solid #cc9933;
    border-radius: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
    flex-shrink: 0;
}

.pin:active {
    transform: scale(0.9);
    background: #ffcc66;
}

.undo-pin {
    background: #e0e0e0;
    border: 3px dashed #999;
    font-size: 16px;
}

.undo-pin:active {
    background: #ccc;
}

/* „Çπ„Ç≥„Ç¢„Ç∑„Éº„Éà */
#scoresheet-container {
    display: none;
    width: 95%;
    max-width: 700px;
    margin: 20px auto;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    overflow-x: auto;
}

#scoresheet {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
}

#scoresheet th,
#scoresheet td {
    border: 1px solid #ccc;
    padding: 6px;
    height: 30px;
    min-width: 40px;
}

#scoresheet tr:nth-child(even) {
    background: #f9f9f9;
}

/* „É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ */
#message-box {
    display: none;
    width: 90%;
    max-width: 400px;
    margin: 10px auto;
    padding: 10px;
    background: #ffe6cc;
    border: 2px solid #cc6600;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
}

/* „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥Ôºà‰∏ãÈÉ®Âõ∫ÂÆöÔºâ */
#reset-btn {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 25px;
    font-size: 16px;
    cursor: pointer;
    z-index: 1000;
    background: #ffeb99;
    border: 2px solid #cc6600;
    border-radius: 8px;
}

/* ‰∏äÈÉ®„É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ */
#top-message-box {
    display: none;
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffeb99;
    border: 2px solid #cc6600;
    border-radius: 8px;
    padding: 12px 20px;
    font-size: 18px;
    font-weight: bold;
    z-index: 1000;
}

/* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
@media screen and (max-width: 480px){
    .pin {
        width: 45px;
        height: 60px;
        font-size: 18px;
    }
    .player-row {
        font-size: 14px;
    }
    button {
        font-size: 14px;
        padding: 8px 16px;
    }
    input {
        font-size: 14px;
        padding: 6px;
    }
    #scoresheet th,
    #scoresheet td {
        min-width: 35px;
        padding: 4px;
        font-size: 12px;
    }
}
</style>
</head>
<body>

<h1>„É¢„É´„ÉÉ„ÇØ„Çπ„Ç≥„Ç¢</h1>

<!-- „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÁîªÈù¢ -->
<div id="setup-screen">
    <h2>„Éó„É¨„Ç§„É§„ÉºÂêç„ÇíÂÖ•Âäõ</h2>
    <div id="player-inputs">
        <div class="player-input">
            <input type="text" placeholder="Player 1" class="player-name">
        </div>
        <div class="player-input">
            <input type="text" placeholder="Player 2" class="player-name">
        </div>
    </div>
    <button onclick="addPlayer()">Ôºã „Éó„É¨„Ç§„É§„ÉºËøΩÂä†</button><br>
    <button onclick="startGame()">„Ç≤„Éº„É†ÈñãÂßã</button>
</div>

<!-- ‰∏äÈÉ®„É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ -->
<div id="top-message-box"></div>

<!-- „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ -->
<div class="scoreboard" id="scoreboard"></div>

<!-- „Éî„É≥ -->
<div class="pins-container" id="pins">
    <div id="undo-pin" class="pin undo-pin">„ÇÇ„Å©„Çã</div>
</div>

<!-- „Çπ„Ç≥„Ç¢„Ç∑„Éº„Éà -->
<div id="scoresheet-container">
    <h3>„Çπ„Ç≥„Ç¢„Ç∑„Éº„Éà</h3>
    <table id="scoresheet"></table>
</div>

<!-- „É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ -->
<div id="message-box"></div>

<!-- „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ -->
<button id="reset-btn">„Ç≤„Éº„É†„Çí„É™„Çª„ÉÉ„Éà</button>

<script>
/* ------------------------------
   JavaScript
------------------------------ */
let players = [];
let turn = 0;
let currentTurn = 1;
let gameOver = false;
let historyStack = [];

const setupScreen = document.getElementById("setup-screen");
const scoreboard = document.getElementById("scoreboard");
const pins = document.getElementById("pins");
const scoresheetContainer = document.getElementById("scoresheet-container");
const scoresheet = document.getElementById("scoresheet");
const undoPin = document.getElementById("undo-pin");
const resetBtn = document.getElementById("reset-btn");
const topMessageBox = document.getElementById("top-message-box");

undoPin.style.display = "none";
resetBtn.style.display = "none";

// --- „Éó„É¨„Ç§„É§„ÉºËøΩÂä† ---
function addPlayer() {
    const div = document.createElement("div");
    div.className = "player-input";
    const index = document.querySelectorAll(".player-name").length + 1;
    div.innerHTML = `<input type="text" placeholder="Player ${index}" class="player-name">`;
    document.getElementById("player-inputs").appendChild(div);
}

// --- „Ç≤„Éº„É†ÈñãÂßã ---
function startGame() {
    const names = [...document.querySelectorAll(".player-name")].map(i => i.value.trim() || i.placeholder);
    players = names.map(n => ({ name: n, score: 0, miss: 0, eliminated: false }));
    setupScreen.style.display = "none";
    scoreboard.style.display = "block";
    pins.style.display = "flex";
    undoPin.style.display = "flex";
    scoresheetContainer.style.display = "block";
    resetBtn.style.display = "none";
    createScoreSheet();
    renderScoreboard();
}

// --- Áä∂ÊÖã‰øùÂ≠ò ---
function saveState() {
    historyStack.push({
        players: JSON.parse(JSON.stringify(players)),
        turn,
        currentTurn,
        gameOver,
        scoresheet: scoresheet.innerHTML
    });
}

// --- Êàª„Çã ---
function undo() {
    if (historyStack.length === 0) return;
    const s = historyStack.pop();
    players = s.players;
    turn = s.turn;
    currentTurn = s.currentTurn;
    gameOver = s.gameOver;
    scoresheet.innerHTML = s.scoresheet;
    topMessageBox.style.display = "none";
    resetBtn.style.display = gameOver ? "block" : "none";
    renderScoreboard();
}

// --- „Çπ„Ç≥„Ç¢„Ç∑„Éº„Éà‰ΩúÊàê ---
function createScoreSheet() {
    scoresheet.innerHTML = "";
    let header = "<tr><th>„Çø„Éº„É≥</th>";
    players.forEach(p => { header += `<th>${p.name}</th><th>ÂêàË®à</th>`; });
    header += "</tr>";
    scoresheet.innerHTML += header;

    for (let i = 1; i <= 15; i++) {
        let row = `<tr id="turn-${i}"><td>${i}</td>`;
        players.forEach(() => row += "<td></td><td></td>");
        row += "</tr>";
        scoresheet.innerHTML += row;
    }
}

// --- „Çπ„Ç≥„Ç¢Ë®òÈå≤ ---
function recordToScoreSheet(playerIndex, score) {
    let row = document.getElementById(`turn-${currentTurn}`);
    if (!row) {
        row = document.createElement("tr");
        row.id = `turn-${currentTurn}`;
        row.innerHTML = `<td>${currentTurn}</td>` + players.map(() => "<td></td><td></td>").join("");
        scoresheet.appendChild(row);
    }
    const cells = row.querySelectorAll("td");
    const scoreCell = 1 + playerIndex * 2;
    const totalCell = scoreCell + 1;
    const originalScore = score === 0 ? "-" : score;
    cells[scoreCell].textContent = originalScore;
    cells[totalCell].textContent = players[playerIndex].score;

    const btnContainer = document.createElement("div");
    btnContainer.style.display = "flex";
    btnContainer.style.justifyContent = "center";
    btnContainer.style.gap = "4px";

    // ÈÄöÂ∏∏„Éú„Çø„É≥
    const btnNormal = document.createElement("button");
    btnNormal.textContent = originalScore;
    btnNormal.style.fontSize = "14px";
    btnNormal.style.padding = "2px 5px";
    btnNormal.onclick = () => { cells[scoreCell].textContent = originalScore; };
    btnContainer.appendChild(btnNormal);

    // ÁÇπ‰ªò„Åç„Éú„Çø„É≥
    const btnDot = document.createElement("button");
    btnDot.textContent = originalScore + ".";
    btnDot.style.fontSize = "14px";
    btnDot.style.padding = "2px 5px";
    btnDot.onclick = () => { cells[scoreCell].textContent = originalScore + "."; };
    btnContainer.appendChild(btnDot);

    // ‚ñ°‰ªò„Åç„Éú„Çø„É≥
    const btnSquare = document.createElement("button");
    btnSquare.textContent = originalScore + "‚ñ°";
    btnSquare.style.fontSize = "14px";
    btnSquare.style.padding = "2px 5px";
    btnSquare.onclick = () => { cells[scoreCell].textContent = originalScore + "‚ñ°"; };
    btnContainer.appendChild(btnSquare);

    // ‰∏∏‰ªò„ÅçÔºà1-12Ôºâ
    if (score >= 1 && score <= 12) {
        const circled = String.fromCharCode(0x2460 + score - 1);
        const btnCircled = document.createElement("button");
        btnCircled.textContent = circled;
        btnCircled.style.fontSize = "14px";
        btnCircled.style.padding = "2px 5px";
        btnCircled.onclick = () => { cells[scoreCell].textContent = circled; };
        btnContainer.appendChild(btnCircled);
    }

    cells[scoreCell].appendChild(btnContainer);
}

// --- „Çπ„Ç≥„Ç¢„Éú„Éº„ÉâË°®Á§∫ ---
function renderScoreboard() {
    scoreboard.innerHTML = "";
    players.forEach((p, i) => {
        scoreboard.innerHTML += `<div class="player-row">
            <span>${i === turn ? "üëâ " : ""}${p.name}${p.eliminated ? "ÔºàËÑ±ËêΩÔºâ" : ""}</span>
            <span>${p.score} ÁÇπ</span>
        </div>`;
    });
}

// --- „Éî„É≥„Çí„Éí„ÉÉ„Éà ---
function hitPin(num) {
    if (gameOver) return;
    saveState();
    const p = players[turn];

    if (num === 0) {
        p.miss++;
        if (p.miss >= 3) p.eliminated = true;
        recordToScoreSheet(turn, 0);
    } else {
        p.miss = 0;
        p.score += num;
        if (p.score > 50) p.score = 25;
        recordToScoreSheet(turn, num);
    }

    renderScoreboard();

    if (p.score === 50) {
        topMessageBox.style.display = "none";
        gameOver = true;
        resetBtn.style.display = "block";
        return;
    }

    nextTurn();
}

// --- Ê¨°„ÅÆ„Çø„Éº„É≥ ---
function nextTurn() {
    let prev = turn;
    do {
        turn = (turn + 1) % players.length;
    } while(players[turn].eliminated);

    if (turn === 0 && prev !== 0) currentTurn++;
}

// --- „Éî„É≥‰ΩúÊàê ---
[1,2,3,4,5,6,7,8,9,10,11,12].forEach(n => {
    const d = document.createElement("div");
    d.className = "pin";
    d.textContent = n;
    d.onclick = () => hitPin(n);
    pins.appendChild(d);
});

// 0„Éî„É≥
const zeroPin = document.createElement("div");
zeroPin.className = "pin";
zeroPin.textContent = "0";
zeroPin.onclick = () => hitPin(0);
pins.appendChild(zeroPin);

// Êàª„Çã„Éú„Çø„É≥
pins.appendChild(undoPin);
undoPin.onclick = undo;

// „É™„Çª„ÉÉ„Éà
resetBtn.onclick = () => location.reload();
</script>

</body>
</html>

